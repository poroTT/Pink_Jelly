<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic.html}">
<head>
    <meta charset="UTF-8">
    <title>비밀번호 변경</title>
    <style>
        .hide {display: none;}
        .fail {color: #ff0000;}
        .success {color: #00ff00;}
    </style>
</head>
<body>

    <div class="hero overlay inner-page bg-primary py-5">
        <div class="container">
            <div class="row align-items-center justify-content-center text-center pt-5">
                <div class="col-lg-6">
                    <h1 class="heading text-white mb-3" data-aos="fade-up">비밀번호 변경</h1>
                </div>
            </div>
        </div>
    </div>

    <div layout:fragment="content">
        <div class="menu">
            <a th:href="@{/member/modifyMemberInfo}">회원정보수정</a>
            <a th:href="@{/member/modifyPasswd}">비밀번호 변경</a>
            <a th:href="@{/member/modifyMyCat}">고양이 정보 수정</a>
        </div>
        <h1> 비밀번호 변경 </h1>
        <div class="row">
            <div class="col-lg-8" data-aos="fade-up" data-aos-delay="200">
                <form id="frmSignUp" th:action="@{/member/modifyPasswd}" method="post">
                    <div class="row">
                        <div class="col-6 mb-3">
                            <input id="passwd" type="password" class="form-control" name="newPasswd" minlength="8" placeholder="비밀번호" required>
                            <span class="checkPW-message">8글자 이상, 영문, 숫자, 특수문자(@$!%*#?&)를 포함하여야 합니다</span>
                        </div>
                        <div class="col-6 mb-3">
                            <input id="password-retype" type="password" class="form-control" minlength="8" placeholder="비밀번호 확인" required>
                            <span class="mismatch-message hide fail"></span>
                        </div>
                    </div>

                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">수정완료</button>
                        <a th:href="@{/member/memberInfo}">
                            <button type="button" class="btn btn-secondary">뒤로가기</button>
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <script src="/js/signup/validation.js"></script>
    </div>


    <script layout:fragment="script" th:inline="javascript">
        const inputPasswd = document.getElementById('passwd');
        const inputPasswdRetype = document.getElementById('password-retype');

        // 비밀번호 유효성 검사
        inputPasswd.addEventListener('keyup', function () {
            const passwd = inputPasswd.value;
            const checkPWMsg = document.querySelector('.checkPW-message');
            if (passwd.length !== 0) {
                if (!strongPassword(passwd)) {
                    checkPWMsg.classList.add('fail');
                }
                else{
                    checkPWMsg.classList.remove('fail');
                }
            }
            else {
                checkPWMsg.classList.remove('fail');
            }
        });

        // 비밀번호 확인
        inputPasswdRetype.addEventListener('keyup', function () {
            const passwdRetype = inputPasswdRetype.value;
            const misMatchMsg = document.querySelector('.mismatch-message');

            if (passwdRetype.length !== 0) {
                misMatchMsg.classList.remove('hide');

                // 비밀번호가 일치하지 않는 경우
                if(!isMatch(inputPasswd.value, passwdRetype)) {
                    misMatchMsg.textContent = '비밀번호가 일치하지 않습니다';
                    misMatchMsg.classList.remove('success');
                }
                else { // 비밀번호가 일치할 경우
                    misMatchMsg.textContent = '비밀번호가 일치합니다';
                    misMatchMsg.classList.add('success');
                }
            }
            else {
                misMatchMsg.classList.add('hide');
            }
        });
    </script>
</body>
</html>